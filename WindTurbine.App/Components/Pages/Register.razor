@page "/register"
@layout WindTurbine.App.Components.Layout.AuthLayout
@using WindTurbine.DTOs.Auth
@using WindTurbine.App.Services  
@using System.ComponentModel.DataAnnotations
@inject NavigationManager NavManager
@inject ISnackbar Snackbar
@inject IApiService ApiService 

<PageTitle>Kayıt Ol</PageTitle>

<MudGrid Class="h-100" Spacing="0">
    <MudItem xs="12" md="6" Class="d-none d-md-flex align-center justify-center" 
             Style="background: linear-gradient(135deg, #0d47a1 0%, #002171 100%); height: 100vh;">
        <div class="d-flex flex-column align-center px-8 text-center">
            <MudIcon Icon="@Icons.Material.Filled.Analytics" Style="font-size: 6rem; color: rgba(255,255,255,0.9);" />
            <MudText Typo="Typo.h4" Class="mt-4" Style="color: white; font-weight: 800;">ARAMIZA KATILIN</MudText>
            <MudText Typo="Typo.subtitle1" Class="mt-2" Style="color: rgba(255,255,255,0.7);">Yapay zeka destekli analizlerle türbinlerinizi yönetin.</MudText>
        </div>
    </MudItem>

    <MudItem xs="12" md="6" Class="d-flex align-center justify-center pa-8" Style="height: 100vh; background-color: white;">
        <div style="width: 100%; max-width: 400px;">
            <MudText Typo="Typo.h4" Color="Color.Primary" Style="font-weight: 700;">Hesap Oluştur</MudText>
            <MudText Typo="Typo.body1" Class="mud-text-secondary mb-8">Bilgilerinizi girerek kayıt olun</MudText>

            <MudForm @ref="form" @bind-IsValid="@success">

                <MudTextField @bind-Value="registerDto.FullName" Label="Ad Soyad" Variant="Variant.Outlined" Required="true" Class="mb-4" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Person"/>

                <MudTextField @bind-Value="registerDto.Email" Label="E-Posta" Variant="Variant.Outlined" Required="true" Class="mb-4" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Email"/>

                <MudTextField @bind-Value="registerDto.Password" Label="Şifre" Variant="Variant.Outlined" InputType="InputType.Password" Required="true" Class="mb-4" Adornment="Adornment.Start" AdornmentIcon="@Icons.Material.Filled.Lock"/>

                <MudTextField @bind-Value="registerDto.ConfirmPassword" 
                              Label="Şifre Tekrar" 
                              Variant="Variant.Outlined" 
                              InputType="InputType.Password" 
                              Required="true" 
                              Validation="@(new Func<string, string>(SifreEslesmeKontrol))"
                              Class="mb-6" 
                              Adornment="Adornment.Start" 
                              AdornmentIcon="@Icons.Material.Filled.LockReset"/>

                <MudButton Variant="Variant.Filled" Color="Color.Primary" Size="Size.Large" FullWidth="true" OnClick="KayitOl" Disabled="@(!success)" Class="mb-4 py-3" Style="font-weight: bold;">KAYIT OL</MudButton>
            </MudForm>

            <div class="d-flex justify-center">
                <MudText Typo="Typo.body2">Zaten hesabınız var mı? <MudLink Href="/" Color="Color.Primary" Underline="Underline.None"><b>Giriş Yap</b></MudLink></MudText>
            </div>
        </div>
    </MudItem>
</MudGrid>

@code {
    bool success;
    MudForm form;
    UserRegisterDto registerDto = new UserRegisterDto();

    private string SifreEslesmeKontrol(string arg)
    {
        if (arg != registerDto.Password)
            return "Şifreler eşleşmiyor!";
        return null;
    }

    private async Task KayitOl()
    {
        form.Validate();
        if (success)
        {
            var sonuc = await ApiService.RegisterAsync(registerDto);
            if (sonuc)
            {
                Snackbar.Add("Kayıt Başarılı! Giriş yapabilirsiniz.", Severity.Success);
                NavManager.NavigateTo("/");
            }
            else
            {
                Snackbar.Add("Kayıt başarısız. E-posta kullanımda olabilir.", Severity.Error);
            }
        }
    }
}