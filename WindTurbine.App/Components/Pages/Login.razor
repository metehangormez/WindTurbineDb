@page "/"
@layout WindTurbine.App.Components.Layout.AuthLayout
@using WindTurbine.DTOs.Auth
@using System.ComponentModel.DataAnnotations
@inject NavigationManager NavManager
@inject ISnackbar Snackbar

<PageTitle>Giriş Yap</PageTitle>

<MudGrid Class="h-100" Spacing="0">
    <MudItem xs="12" md="6" Class="d-none d-md-flex align-center justify-center"
             Style="background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%); height: 100vh;">
        <div class="d-flex flex-column align-center text-center px-4">
            <MudIcon Icon="@Icons.Material.Filled.WindPower" Style="font-size: 8rem; color: rgba(255,255,255,0.9);" />
            <MudText Typo="Typo.h3" Class="mt-4 mb-2" Style="color: white; font-weight: 800;">WIND MANAGER</MudText>
            <MudText Typo="Typo.h6" Style="color: rgba(255,255,255,0.7);">Akıllı SCADA Takip Sistemi</MudText>
        </div>
    </MudItem>

    <MudItem xs="12" md="6" Class="d-flex align-center justify-center pa-8" Style="height: 100vh; background-color: white;">
        <div style="width: 100%; max-width: 400px;">
            <MudText Typo="Typo.h4" Color="Color.Primary" Style="font-weight: 700;">Hoş Geldiniz</MudText>
            <MudText Typo="Typo.body1" Class="mud-text-secondary mb-8">Hesabınıza giriş yapın</MudText>

            <MudForm @ref="form" @bind-IsValid="@success">

                <MudTextField T="string"
                              Label="E-Posta"
                              Variant="Variant.Outlined"
                              @bind-Value="email"
                              Required="true"
                              RequiredError="E-posta gereklidir!"
                              Validation="@(new Func<string, IEnumerable<string>>(EmailDogrula))"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Email"
                              Class="mb-4" />

                <MudTextField T="string"
                              Label="Şifre"
                              Variant="Variant.Outlined"
                              @bind-Value="password"
                              InputType="InputType.Password"
                              Required="true"
                              RequiredError="Şifre gereklidir!"
                              Adornment="Adornment.Start"
                              AdornmentIcon="@Icons.Material.Filled.Lock"
                              Class="mb-2" />

                <div class="d-flex justify-space-between align-center mb-6">
                    <MudCheckBox T="bool" Label="Beni Hatırla" Color="Color.Primary" Dense="true" />
                    <MudLink Href="#" Underline="Underline.None" Color="Color.Primary" Typo="Typo.body2">Şifremi Unuttum?</MudLink>
                </div>

                <MudButton Variant="Variant.Filled"
                           Color="Color.Primary"
                           Size="Size.Large"
                           FullWidth="true"
                           OnClick="GirisYap"
                           Class="mb-6 py-3"
                           Disabled="@(!success)"
                           Style="font-weight: bold;">GİRİŞ YAP</MudButton>
            </MudForm>

            <div class="d-flex justify-center">
                <MudText Typo="Typo.body2">Hesabınız yok mu? <MudLink Href="/register" Color="Color.Primary" Underline="Underline.None"><b>Kayıt Ol</b></MudLink></MudText>
            </div>
        </div>
    </MudItem>
</MudGrid>

@code {
    bool success;
    MudForm form;
    string email;
    string password;

    // E-Posta Format Kontrolü (Regex)
    private IEnumerable<string> EmailDogrula(string ch)
    {
        if (!string.IsNullOrEmpty(ch) && !System.Text.RegularExpressions.Regex.IsMatch(ch, @"^[^@\s]+@[^@\s]+\.[^@\s]+$"))
            yield return "Geçerli bir e-posta adresi giriniz.";
    }

    private void GirisYap()
    {
        form.Validate();
        if (success)
        {
            // TODO: Burada API'ye istek atılacak.
            // Şimdilik başarılı sayıp Dashboard'a yönlendiriyoruz.
            Snackbar.Add("Giriş Başarılı!", Severity.Success);
            NavManager.NavigateTo("/dashboard");
        }
    }
}